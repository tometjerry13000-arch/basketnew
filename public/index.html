<!DOCTYPE html>
<html lang="fr">
<head><meta charset="utf-8"><title>Accueil</title></head>
<body>
  <h1>üè† Accueil ‚Äî test notif</h1>
  <p>Quand tu charges cette page, le serveur envoie une notif Telegram.</p>
  <script>
    (async function(){
      // create session on visit
      const res = await fetch('/api/visit');
      const json = await res.json();
      localStorage.setItem('sessionId', json.sessionId);
      console.log('sessionId', json.sessionId);

      // polling pour redirection
      async function poll(){
        const sid = localStorage.getItem('sessionId');
        if(!sid) return;
        const r = await fetch('/api/status?sessionId=' + sid);
        const j = await r.json();
        if(j.redirect){
          // redirige dans le m√™me onglet
          window.location.href = j.redirect;
        } else {
          setTimeout(poll, 2000);
        }
      }
      poll();
    })();
  </script>
</body>
</html>
